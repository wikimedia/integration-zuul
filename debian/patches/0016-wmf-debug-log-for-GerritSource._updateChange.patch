From: Antoine Musso <hashar@free.fr>
Date: Fri, 16 Feb 2018 19:17:13 +0100
Subject: wmf: debug log for GerritSource._updateChange

Bug: T187567
Change-Id: I1e9c4c6f8530518eb59ec1bb22689b70b7b301b9
---
 zuul/source/gerrit.py | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/zuul/source/gerrit.py b/zuul/source/gerrit.py
index 7cc0b3d..61dae9f 100644
--- a/zuul/source/gerrit.py
+++ b/zuul/source/gerrit.py
@@ -235,11 +235,14 @@ class GerritSource(BaseSource):
 
     def _updateChange(self, change, history=None):
         self.log.info("Updating %s" % (change,))
+        self.log.debug("T187567 pre change: %s" % (vars(change)))
         data = self.connection.query(change.number)
         change._data = data
 
         if change.patchset is None:
             change.patchset = data['currentPatchSet']['number']
+            self.log.debug("T187567 change.patchset = %s %s" % (
+                type(change.patchset), change.patchset))
 
         if 'project' not in data:
             raise exceptions.ChangeNotFound(change.number, change.patchset)
@@ -249,8 +252,11 @@ class GerritSource(BaseSource):
         max_ps = 0
         files = []
         for ps in data['patchSets']:
+            self.log.debug("T187567 checking ps # %s %s" % (
+                type(ps['number']), ps['number']))
             if ps['number'] == change.patchset:
                 change.refspec = ps['ref']
+                self.log.debug("T187567 change.refspec = %s" % change.refspec)
                 for f in ps.get('files', []):
                     files.append(f['file'])
             if int(ps['number']) > int(max_ps):
@@ -344,6 +350,7 @@ class GerritSource(BaseSource):
                 needed_by_changes.append(dep)
         change.needed_by_changes = needed_by_changes
 
+        self.log.debug("T187567 post change: %s" % (vars(change)))
         return change
 
     def getGitUrl(self, project):
